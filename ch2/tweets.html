<!doctype html>

<html>
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.8/d3.min.js"></script>
    </head>
    <body>
    </body>

    <script>
        let tweets = d3.json("../data/tweets.json", renderTweets)

        function renderTweets(data) {

            let tweetsByAuthor = d3.nest()
                                    .key(d => d.user)
                                    .entries(data.tweets)                 
            
            tweetsByAuthor.forEach(d => { d.numTweets = d.values.length })

            let maxTweets = d3.max(tweetsByAuthor, d => parseInt(d.numTweets))

            let containerWidth = 500
            let containerHeight = 500

            let yScaleTweets = d3.scaleLinear()
                                .domain([0, maxTweets])
                                .range([0, containerHeight])

            d3.select("body")
            .append("svg")
            .attr("height", containerHeight)
            .attr("width", containerWidth)
            .selectAll("rect")
            .data(tweetsByAuthor)
            .enter()
            .append("rect")
            .attr("class", "tweets")
            .attr("x", (d, i) => i * 20)
            .attr("y", d => containerHeight - yScaleTweets(parseInt(d.numTweets)))
            .attr("width", 10)
            .attr("height", d => yScaleTweets(parseInt(d.numTweets)))
            .attr("stroke-width", "1px")
            .attr("stroke", "#FE9922")
            .attr("fill", "#9A8B7A")
        }

    </script>
</html>
